<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EagleGroup</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
/* ==================== BODY ==================== */
body{
  margin:0;
  font-family:'Poppins',sans-serif;
  background:#fff; /* asosiy rang oq */
  color:#000;     /* matn qora */
}
.page{display:none;padding:15px;padding-bottom:120px;}
.active{display:block;}
h3{margin-top:0;margin-bottom:15px;}

/* ==================== PRODUCT / CART / HISTORY ==================== */
.product,.cart-item,.history-item{
  background:#f0f0f0;  /* qoâ€˜shimcha rang kulrang */
  padding:12px;
  margin-bottom:12px;
  border-radius:14px;
  display:flex;
  gap:12px;
  align-items:center;
  cursor:pointer;
  border:1px solid #ccc; /* kulrang border */
}
.product img,.cart-item img,.history-item img{
  width:65px;height:65px;
  border-radius:10px;
  object-fit:cover;
}
button{
  padding:10px;
  border-radius:8px;
  border:none;
  font-weight:600;
  cursor:pointer;
}
.primary{background:#000;color:#fff;} /* asosiy rang qora tugma */
.secondary{background:#e0e0e0;color:#000;border:1px solid #ccc;} /* qoâ€˜shimcha kulrang */
button:disabled{background:#ccc;color:#888;}
input{
  width:100%;
  padding:12px;
  border-radius:8px;
  border:1px solid #ccc;
  background:#f9f9f9; /* qoâ€˜shimcha kulrang input */
  color:#000;
  margin-bottom:10px;
}
.search{margin-bottom:15px;}

/* ==================== NAVBAR ==================== */
.navbar{
  position:fixed;
  bottom:0;
  width:100%;
  background:#f0f0f0; /* qoâ€˜shimcha kulrang */
  display:flex;
  justify-content:space-around;
  padding:8px 0;
  border-top:1px solid #ccc;
}
.navbar button{
  background:none;
  color:#000;
  font-size:12px;
}

/* ==================== MODAL ==================== */
.modal{
  display:none;
  position:fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background:rgba(0,0,0,0.3);
  justify-content:center;
  align-items:center;
}
.modal-content{
  background:#f0f0f0;
  width:90%;
  max-width:360px;
  border-radius:16px;
  padding:15px;
  text-align:center;
  border:1px solid #ccc;
}
.modal-content img{
  width:100%;
  border-radius:12px;
  margin-bottom:15px;
}
.qty-box{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:15px;
  margin-bottom:10px;
}
.qty-box button{
  width:40px;
  height:40px;
  background:#000; /* asosiy rang qora */
  color:#fff;
  border-radius:50%;
}
.close-btn{
  background:#e0e0e0;
  color:#000;
  width:100%;
  margin-top:10px;
}
</style>
</head>
<body>

<!-- ==================== MENU ==================== -->
<div id="menu" class="page active">
  <h3 id="menuTitle">Mahsulotlar</h3>
  <input class="search" type="text" id="searchMenu" placeholder="Qidirish..." oninput="renderProducts()">
  <div id="productList"></div>
</div>

<!-- ==================== DISCOUNT ==================== -->
<div id="discount" class="page">
  <h3 id="discountTitle">Skidkalar</h3>
  <input class="search" type="text" id="searchDiscount" placeholder="Qidirish..." oninput="renderDiscounts()">
  <div id="discountList"></div>
</div>

<!-- ==================== CART ==================== -->
<div id="cart" class="page">
  <h3 id="cartTitle">Savatcha</h3>
  <input type="text" id="cartName" placeholder="Ism Familiya" oninput="checkOrderBtn()">
  <input type="text" id="cartPhone" placeholder="+998901234567" oninput="checkOrderBtn()">
  <div id="cartItems"></div>
  <h3 id="total"></h3>
  <button id="orderBtn" class="primary" onclick="sendOrder()" disabled>Buyurtma berish</button>
</div>

<!-- ==================== HISTORY ==================== -->
<div id="history" class="page">
  <h3 id="historyTitle">Buyurtmalar tarixi</h3>
  <div id="historyList"></div>
</div>

<!-- ==================== PROFILE ==================== -->
<div id="profile" class="page">
  <h3 id="profileTitle">Profil</h3>
  <input type="text" id="profileName" placeholder="Ism Familiya">
  <input type="text" id="profilePhone" placeholder="+998901234567">
  <button class="primary" onclick="saveProfile()">Saqlash</button>
  <hr style="border:1px solid #ccc;margin:20px 0">
  <button class="secondary" onclick="setLang('uz')">UZ</button>
  <button class="secondary" onclick="setLang('ru')">RU</button>
</div>

<!-- ==================== NAVBAR ==================== -->
<div class="navbar">
  <button onclick="showPage('menu')">Menu</button>
  <button onclick="showPage('discount')">Skidka</button>
  <button onclick="showPage('cart');loadCart()">Savatcha</button>
  <button onclick="showPage('history');renderHistory()">Tarix</button>
  <button onclick="showPage('profile');loadProfile()">Profil</button>
</div>

<!-- ==================== MODAL ==================== -->
<div id="productModal" class="modal">
  <div class="modal-content">
    <img id="modalImg">
    <h3 id="modalName"></h3>
    <p id="modalPrice"></p>
    <div id="modalAction"></div>
    <button class="close-btn" onclick="closeModal()">Yopish</button>
  </div>
</div>

<script>
const botToken="8273671173:AAFhV95y1VN3bEcj1QSbXlSaqrsSYAGnijg";
const chatId="8336275561";
let lang=localStorage.getItem("lang")||"uz";

let products=[
  {name:'8 ELEMENT',price:42000,img:'https://cdn1.ozone.ru/s3/multimedia-1-2/7552305362.jpg'},
  {name:'Samsung S23',price:7500000,img:'https://images.samsung.com/is/image/samsung/p6pim/uz/2302/gallery/uz-galaxy-s23-s911-sm-s911bzkgcau-thumb-534863122'}
];

let discounts=[
  {name:'AirPods',price:85000,img:'https://images.uzum.uz/d2rg88b4eu2h0tmq7hj0/original.jpg',old:95000}
];

let cart=JSON.parse(localStorage.getItem('cart'))||[];
let history=JSON.parse(localStorage.getItem('history'))||[];
let profile=JSON.parse(localStorage.getItem('profile'))||{};
let currentProduct=null;

function setLang(l){lang=l;localStorage.setItem("lang",l);applyLang();}
function applyLang(){
  if(lang==="ru"){
    menuTitle.innerText="Ð¢Ð¾Ð²Ð°Ñ€Ñ‹";
    discountTitle.innerText="Ð¡ÐºÐ¸Ð´ÐºÐ¸";
    cartTitle.innerText="ÐšÐ¾Ñ€Ð·Ð¸Ð½Ð°";
    historyTitle.innerText="Ð˜ÑÑ‚Ð¾Ñ€Ð¸Ñ Ð·Ð°ÐºÐ°Ð·Ð¾Ð²";
    profileTitle.innerText="ÐŸÑ€Ð¾Ñ„Ð¸Ð»ÑŒ";
    orderBtn.innerText="ÐžÑ„Ð¾Ñ€Ð¼Ð¸Ñ‚ÑŒ Ð·Ð°ÐºÐ°Ð·";
  }else{
    menuTitle.innerText="Mahsulotlar";
    discountTitle.innerText="Skidkalar";
    cartTitle.innerText="Savatcha";
    historyTitle.innerText="Buyurtmalar tarixi";
    profileTitle.innerText="Profil";
    orderBtn.innerText="Buyurtma berish";
  }
}

function renderProducts(){
  let q=searchMenu.value.toLowerCase();
  productList.innerHTML="";
  products.filter(p=>p.name.toLowerCase().includes(q))
  .forEach(p=>{
    productList.innerHTML+=`
    <div class='product' onclick='openModal(${JSON.stringify(p)})'>
      <img src='${p.img}'>
      <div>
        <h4>${p.name}</h4>
        <p>${p.price.toLocaleString()} so'm</p>
      </div>
    </div>`;
  });
}

function renderDiscounts(){
  let q=searchDiscount.value.toLowerCase();
  discountList.innerHTML="";
  discounts.filter(p=>p.name.toLowerCase().includes(q))
  .forEach(p=>{
    discountList.innerHTML+=`
    <div class='product' onclick='openModal(${JSON.stringify(p)})'>
      <img src='${p.img}'>
      <div>
        <h4>${p.name}</h4>
        <p><s>${p.old.toLocaleString()}</s> â†’ ${p.price.toLocaleString()} so'm</p>
      </div>
    </div>`;
  });
}

function openModal(p){
  currentProduct=p;
  modalImg.src=p.img;
  modalName.innerText=p.name;
  modalPrice.innerText=p.price.toLocaleString()+" so'm";
  updateModalButtons();
  productModal.style.display="flex";
}

function closeModal(){productModal.style.display="none";}

function updateModalButtons(){
  let item=cart.find(i=>i.name===currentProduct.name);
  if(item){
    modalAction.innerHTML=`<div class="qty-box">
      <button onclick="changeQty(-1)">-</button>
      <span>${item.qty}</span>
      <button onclick="changeQty(1)">+</button>
    </div>`;
  }else{
    modalAction.innerHTML=`<button class="primary" onclick="addToCart()">Savatchaga qo'shish</button>`;
  }
}

function addToCart(){
  let item=cart.find(i=>i.name===currentProduct.name);
  if(item)item.qty++;
  else cart.push({...currentProduct,qty:1});
  localStorage.setItem("cart",JSON.stringify(cart));
  updateModalButtons();
  loadCart();
}

function changeQty(v){
  let item=cart.find(i=>i.name===currentProduct.name);
  if(!item) return;
  item.qty+=v;
  if(item.qty<=0) cart=cart.filter(i=>i.name!==currentProduct.name);
  localStorage.setItem("cart",JSON.stringify(cart));
  updateModalButtons();
  loadCart();
}

function loadCart(){
  cartItems.innerHTML="";
  let total=0;
  cart.forEach(i=>{
    total+=i.price*i.qty;
    cartItems.innerHTML+=`
    <div class="cart-item">
      <div style="flex:1">${i.name} x${i.qty}</div>
      <div>
        <button class="secondary" onclick="adjustCart('${i.name}',-1)">-</button>
        <button class="secondary" onclick="adjustCart('${i.name}',1)">+</button>
      </div>
    </div>`;
  });
  totalElem=document.getElementById("total");
  totalElem.innerText="Jami: "+total.toLocaleString()+" so'm";
  if(profile.name) cartName.value=profile.name;
  if(profile.phone) cartPhone.value=profile.phone;
  checkOrderBtn();
}

function adjustCart(name,v){
  let item=cart.find(i=>i.name===name);
  if(!item) return;
  item.qty+=v;
  if(item.qty<=0) cart=cart.filter(i=>i.name!==name);
  localStorage.setItem("cart",JSON.stringify(cart));
  loadCart();
  if(currentProduct && currentProduct.name===name) updateModalButtons();
}

function checkOrderBtn(){
  let name=cartName.value.trim();
  let phone=cartPhone.value.trim();
  orderBtn.disabled=!(name && phone && cart.length>0);
}

function sendOrder(){
  let name=cartName.value.trim();
  let phone=cartPhone.value.trim();
  if(!name || !phone || cart.length===0) return;
  profile={name,phone};
  localStorage.setItem("profile",JSON.stringify(profile));
  let total=0;
  let message="ðŸ›’ YANGI BUYURTMA\n\nðŸ‘¤ Ism: "+name+"\nðŸ“ž Telefon: "+phone+"\n\nðŸ“¦ Mahsulotlar:\n";
  cart.forEach(i=>{
    message+=i.name+" x"+i.qty+" - "+(i.price*i.qty).toLocaleString()+" so'm\n";
    total+=i.price*i.qty;
  });
  message+="\nðŸ’° Jami: "+total.toLocaleString()+" so'm";
  fetch(`https://api.telegram.org/bot${botToken}/sendMessage?chat_id=${chatId}&text=${encodeURIComponent(message)}`)
  .then(res=>{
    if(res.ok){
      alert(lang==="ru"?"Ð—Ð°ÐºÐ°Ð· Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½!":"Buyurtma yuborildi!");
      history.push({name,phone,items:[...cart],total});
      localStorage.setItem("history",JSON.stringify(history));
      cart=[];
      localStorage.setItem("cart",JSON.stringify(cart));
      loadCart();
    }else alert("Telegramga yuborishda xatolik!");
  });
}

function renderHistory(){
  historyList.innerHTML="";
  history.forEach(h=>{
    let itemsText=h.items.map(it=>it.name+" x"+it.qty).join(", ");
    historyList.innerHTML+=`
    <div class="history-item">
      <div style="flex:1">${h.name} | ${h.phone}</div>
      <div>${itemsText} | Jami: ${h.total.toLocaleString()} so'm</div>
    </div>`;
  });
}

function saveProfile(){
  profile={name:profileName.value,phone:profilePhone.value};
  localStorage.setItem("profile",JSON.stringify(profile));
  alert(lang==="ru"?"Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¾!":"Saqlandi");
}

function loadProfile(){
  profileName.value=profile.name||"";
  profilePhone.value=profile.phone||"";
}

function showPage(id){
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

window.onload=function(){
  renderProducts();
  renderDiscounts();
  applyLang();
  loadProfile();
};
</script>
</body>
</html>